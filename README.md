# Бот-ассистент (Telegram api-bot)

## Описание
Telegram-бот, который обращается к API сервиса Практикум.Домашка и узнает статус домашней работы (взята ли в ревью, проверена ли, а если проверена — то принял её ревьюер или вернул на доработку).

***Функции:***
- раз в 10 минут опрашивает API сервиса Практикум.Домашка и проверяет статус отправленной на ревью домашней работы;
- при обновлении статуса анализирует ответ API и отправлять соответствующее уведомление в Telegram;
- логирует свою работу и сообщает о важных проблемах сообщением в Telegram.

***Логирование***
Обязательно логируются такие события:
* отсутствие обязательных переменных окружения во время запуска бота (уровень CRITICAL).
* удачная отправка любого сообщения в Telegram (уровень INFO);
* сбой при отправке сообщения в Telegram (уровень ERROR);
* недоступность эндпоинта https://practicum.yandex.ru/api/user_api/homework_statuses/ (уровень ERROR);
* любые другие сбои при запросе к эндпоинту (уровень ERROR);
* отсутствие ожидаемых ключей в ответе API (уровень ERROR);
* недокументированный статус домашней работы, обнаруженный в ответе API (уровень ERROR);
* отсутствие в ответе новых статусов (уровень DEBUG).

Если при каждой попытке бота получить и обработать информацию от API ошибка повторяется — отправляется лишь одно сообщение(в логи записывается информация о каждой неудачной попытке).
Пример логов:
> 2022-06-24 15:34:05,377 - [CRITICAL] - Обязательные переменные окружения отсутствуют. Принудительная остановка Бота

Обработчик StreamHandler, выводит логи в стандартный поток sys.stdout.

---
## Установка:
### Команды для запуска бота
В терминале, перейдите в каталог, в который будет загружаться приложение:
```
cd 
```
Клонируйте репозиторий:
```
git clone git@github.com:SobolyaRA/homework_bot.git
```
Далее перейдите в каталог приложения:
```
cd
```
Установите виртуальное окружение:
```
python3 -m venv venv
```
Активируйте виртуальное окружение:
```
source venv/bin/activate
```
Установите зависимости:
```
pip3 install -r requirements.txt
```
Создайте файл ".env" в каталоге с программой.
Конфиденциальные данные храните в переменных окружения.
Шаблон наполнения env-файла:
```
TELEGRAM_CHAT_ID=___
PRACTICUM_TOKEN=___
TELEGRAM_TOKEN=___
```
Запустите бота:
```
python3 homework.py
```

### Размещение проекта на Heroku
В файле Procfile указана «точка входа» — файл, который должен быть выполнен для запуска проекта.

---
## Структура программы:
***Функции***
* **main()**: в ней описана основная логика работы программы. Все остальные функции запускаются из неё. Последовательность действий:
    * Сделать запрос к API
    * Проверить ответ
    * Если есть обновления — получить статус работы из обновления и отправить сообщение в Telegram.
    * Подождать некоторое время и сделать новый запрос.
* **check_tokens()** проверяет доступность переменных окружения, которые необходимы для работы программы. Если отсутствует хотя бы одна переменная окружения — функция возвращает False, иначе — True.
* **get_api_answer()** делает запрос к единственному эндпоинту API-сервиса. В качестве параметра функция получает временную метку. В случае успешного запроса должна вернуть ответ API, преобразовав его из формата JSON к типам данных Python.
* **check_response()** проверяет ответ API на корректность. В качестве параметра функция получает ответ API, приведенный к типам данных Python. Если ответ API соответствует ожиданиям, то функция должна вернуть список домашних работ (он может быть и пустым), доступный в ответе API по ключу 'homeworks'.
* **parse_status()** извлекает из информации о конкретной домашней работе статус этой работы. В качестве параметра функция получает только один элемент из списка домашних работ. В случае успеха, функция возвращает подготовленную для отправки в Telegram строку, содержащую один из вердиктов словаря HOMEWORK_STATUSES.
* **send_message()** отправляет сообщение в Telegram чат, определяемый переменной окружения TELEGRAM_CHAT_ID. Принимает на вход два параметра: экземпляр класса Bot и строку с текстом сообщения.
